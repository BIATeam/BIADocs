---
layout: default
title: Keycloak
parent: Features
grand_parent: Developer guide
nav_order: 130
---

# Keycloak authentication

This file explains the Keycloak authentication.

## Overview

The application is secured via a JWT generated by the backend. But before its generation, a first authentication is necessary: either Windows, or via a JWT provided by Keycloak. In previous versions of BIA framemwork (<= 3.6), windows authentication was used. we will see here via Keycloak.

## How Activate

To switch from windows authentication to Keycloak, you must have at least version 3.7 of the BIA framework.

### Front End

Change this parameter to **true**.

```ts
export const allEnvironments = {
    ...
    useKeycloak: true,
    ...
};
```

And add here the configuration of your keycloak in your environment files

(Values are to be adapted according to your Keycloak)

```ts
export const environment = {
  ...
  keycloak: {
    conf: {
      realm: 'BIA-Realm',
      authServerUrl: 'http://localhost:8080/',
      resource: 'biademo-front'
    }
  }
  ...
};
```

### Back End

On your web server, disable windows authentication for your back end application.

At the source code level, in the **launchSettings.json** file, Change these settings as follows:

```json
{
  "iisSettings": {
    "windowsAuthentication": false,
    "anonymousAuthentication": true,
    ...
  },
}
```

In **Api.Controllers.Base.AuthControllerBase**, replace **BiaControllerBaseNoToken** by **BiaControllerBaseIdP**

```csharp
public abstract class AuthControllerBase : BiaControllerBaseIdP
```

Add the Keycloak configuration in your different files **bianetconfig.XXX.json**

(Values are to be adapted according to your Keycloak)

```json
"Authentication": {
      "Keycloak": {
        "BaseUrl": "http://localhost:8080",
        "Configuration": {
          "Authority": "/realms/BIA-Realm",
          "RequireHttpsMetadata": false,
          "ValidAudience": "account"
        },
        "Api": {
          "TokenConf": {
            "RelativeUrl": "/realms/BIA-Realm/protocol/openid-connect/token",
            "ClientId": "biademo-front",
            "GrantType": "password",
            "CredentialKeyInWindowsVault": "BIA:KeycloakSearchUserAccount"
          },
          "SearchUserRelativeUrl": "/admin/realms/BIA-Realm/users"
        }
      },
      ...
}
```

The login and password of the keycloak account that owns the role **view-users** must be registered in the vault via this command while connected with the application pool account:

```bat
%windir%\system32\cmdkey.exe /generic:BIA:KeycloakSearchUserAccount /user:"MyLogin" /pass:"MyPassword"
```
